dnl Process this file with autoconf to produce a configure script.
AC_INIT(src/matrices/matrices.c)
AC_CONFIG_HEADER(src/config.h)

AC_ARG_ENABLE(single, [  --enable-single         compile for single precision], enable_single=$enableval, enable_single=no)
if test "$enable_single" = "yes"; then
        AC_DEFINE(SCALAR_SINGLE_PREC)
fi

AC_ARG_ENABLE(complex, [  --disable-complex       don't use complex numbers (require inv. sym.)], ok=$enableval, ok=yes)
if test "$ok" = "yes"; then
        AC_DEFINE(SCALAR_COMPLEX)
fi

# Use native cc if present
AC_MSG_CHECKING([for vendor's cc to be used instead of gcc])
AC_MSG_RESULT()
AC_CHECK_PROG(CC, cc, cc)

# Use native f77 if present
AC_MSG_CHECKING([for vendor's f77 to be used instead of f77])
AC_MSG_RESULT()
AC_CHECK_PROGS(F77, f77 f90 xlf90)

dnl Checks for programs.
AC_PROG_CC
AC_PROG_RANLIB
AC_PROG_MAKE_SET

CFLAGS="-O3"

AC_ARG_ENABLE(debug, [  --enable-debug          compile for debugging], ok=$enableval, ok=no)
if test "$ok" = "yes"; then
	CFLAGS="-g"
	AC_DEFINE(DEBUG)
fi

AC_ARG_ENABLE(prof, [  --enable-prof           compile for profiling], ok=$enableval, ok=no)
if test "$ok" = "yes"; then
	CFLAGS="$CFLAGS -pg"
	AC_DEFINE(ENABLE_PROF)
fi

AC_ARG_ENABLE(checks, [  --disable-checks        disable runtime checks], ok=$enableval, ok=yes)
if test "$ok" = "no"; then
	AC_DEFINE(CHECK_DISABLE)
fi

AC_ARG_WITH(fftw, [  --with-fftw=<dir>       specify fftw directory], ok=$withval, ok=yes)
if test "$ok" = "no"; then
        AC_ERROR(FFTW is required and you may not disable it)
elif test "$ok" != "yes"; then
	CFLAGS="$CFLAGS -I$ok"
	LDFLAGS="$LDFLAGS -L$ok"
fi

# Add path for config.h to include path:
CFLAGS="$CFLAGS -I`pwd`/src"

dnl Checks for libraries.
AC_CHECK_LIB(m, sqrt)

AC_F77_LIBRARY_LDFLAGS

dnl Check for FFTW libraries
if test "$enable_single" = "yes"; then
	AC_CHECK_LIB(sfftw, fftw)
	AC_CHECK_LIB(srfftw, rfftw)
else
	AC_CHECK_LIB(dfftw, fftw)
	AC_CHECK_LIB(drfftw, rfftw)
fi

if test -z "`echo $LIBS | grep fftw`"; then
	AC_CHECK_LIB(fftw, fftw)
	AC_CHECK_LIB(rfftw, rfftw)
fi

dnl Checks for BLAS & LAPACK libraries:
AC_CHECK_LIB(blasppro1,main)
AC_CHECK_LIB(blas, main)
AC_CHECK_LIB(lapack, main)

dnl Checks for BLAS dgemm/sgemm libraries (produced by PhiPACK):
AC_CHECK_LIB(dgemm, main)
AC_CHECK_LIB(sgemm, main)

dnl Checks for IBM ESSL library: -lessl
AC_CHECK_LIB(essl, dcft)

dnl Checks for header files.
AC_HEADER_STDC
AC_CHECK_HEADERS(unistd.h getopt.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_C_INLINE

dnl Checks for library functions.
AC_CHECK_FUNCS(getopt)

AC_OUTPUT(Makefile tests/Makefile src/util/Makefile src/matrices/Makefile src/maxwell/Makefile photon-ctl/Makefile)
