<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML><HEAD>
<TITLE>Installation</TITLE>
<LINK rel="Contents" href="index.html">
<LINK rel="Copyright" href="license.html">
<LINK rel="Start" href="index.html">
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFFF">

Go to the <a href="user-tutorial.html">next</a>, <a
href="introduction.html">previous</a>, or <a href="index.html">main</a>
section.
<hr>

<h1>Installation</h1>

<p>In this section, we outline the procedure for installing the MIT
Photonic-Bands package.  Mainly, this consists of downloading and
installing various prerequisites.  As much as possible, we have
attempted to take advantage of existing packages such as BLAS, LAPACK,
FFTW, and GNU Guile, in order to make our code smaller, more robust,
faster, and more flexible.  Unfortunately, this may make the
installation of Photonic-Bands more complicated if you do not already
have these packages.

<p>You will also need an ANSI C compiler, of course (gcc is fine), and
installation will be easiest on a UNIX-like system (Linux is fine).
In the following list, some of the packages are dependent upon
packages listed earlier, so you should install them in more-or-less
the order given.

<h2>BLAS</h2>

<p>The first thing you must have on your system is a BLAS
implementation.  "BLAS" stands for "Basic Linear Algebra Subroutines,"
and is a standard interface for operations like matrix multiplication.
It is designed as a building-block for other linear-algebra
applications, and is used both directly by our code and in LAPACK (see
below).  By using it, we can take advantage of many highly-optimized
implementations of these operations that have been written to the BLAS
interface.  (Note that you will need implementations of BLAS levels 1-3.)

<p>You can find more BLAS information, as well as a basic
implementation, on the <a href="http://www.netlib.org/blas/">BLAS
Homepage</a>.  Once you get things working with the basic BLAS
implementation, it might be a good idea to try and find a more
optimized BLAS code for your hardware.  Vendor-optimized BLAS
implementations are available as part of the Compaq CXML, IBM ESSL,
SGI sgimath, and other libraries.  Recently, there has also been work
on self-optimizing BLAS implementations that can achieve performance
competitive with vendor-tuned codes; see the <a
href="http://www.cs.berkeley.edu/~siyer/">PhiPACK</a> and <a
href="http://www.netlib.org/atlas/">ATLAS</a> homepages (these only
implement some BLAS operations, however, so you will still need a
generic BLAS).  Links to more BLAS implementations can be found on <a
href="http://SAL.KachinaTech.COM/B/0/BLAS.html" title="Scientific
Applications on Linux (SAL) BLAS page">SAL</a>.

<p>Note that the generic BLAS does not come with a
<code>Makefile</code>; compile it with something like:

<pre>
mkdir blas && cd blas # the BLAS archive does not create its own directory
<i>get http://www.netlib.org/blas/blas.tgz</i>
gunzip blas.tgz
tar xf blas.tar
f77 -c -O3 *.f   # compile all of the .f files to produce .o files
ar rv libblas.a *.o    #  combine the .o files into a library
su -c "cp libblas.a /usr/local/lib"   # switch to root and install
</pre>

<p>(Replace <code>-O3</code> with your favorite optimization options.
On Linux, I use <code>g77 -O3 -fomit-frame-pointer
-funroll-loops</code>, with <code>-malign-double -mcpu=i686</code> on
a Pentium II.)  Note that MPB looks for the standard BLAS library with
<code>-lblas</code>, so the library file should be called
<code>libblas.a</code> and reside in a standard directory like
<code>/usr/local/lib</code>.  (See also below for the
<code>--with-fastblas=<i>lib</i></code> option to MPB's
<code>configure</code> script and the <code>LDFLAGS</code> environment
variable.)

<h2>LAPACK</h2>

<p>LAPACK, the Linear Algebra PACKage, is a standard collection of
routines, built on BLAS, for more-complicated (dense) linear algebra
operations like matrix inversion and diagonalization.  You can
download LAPACK from the <a
href="http://www.netlib.org/lapack/">LAPACK Home Page</a>.  More
LAPACK links can be found on <a
href="http://SAL.KachinaTech.COM/B/0/LAPACK.html" title="Scientific
Applications on Linux (SAL) LAPACK page">SAL</a>.

<p>Note that MPB looks for LAPACK by linking with
<code>-llapack</code>.  This means that the library must be called
<code>liblapack.a</code> and be installed in a standard directory like
<code>/usr/local/lib</code> (alternatively, you can specify another
directory via the <code>LDFLAGS</code> environment variable; see
below).

<h2>MPI <i>(optional)</i></h2>

<p>Optionally, MPB will someday be able to run on a distributed-memory
parallel machine, and to do this we use the standard MPI
message-passing interface.  You can download and learn about MPI from
the <a href="http://www-unix.mcs.anl.gov/mpi/index.html">MPI Home
Page</a>.  Most commercial supercomputers already have an MPI
implementation installed.

<p>MPI is <i>not required</i> to compile the ordinary, uniprocessor
version of Photonic-Bands.  In fact, our MPI code is not even fully
implemented yet; thank you for your patience (we value your call).

<h2>HDF5 <i>(optional)</i></h2>

<p>We require a portable, standard binary format for outputting the
electromagnetic fields and similar volumetric data, and for this we
use HDF.  (If you don't have HDF5, you can still compile
Photonic-Bands, but you won't be able to output the fields or the
dielectric function.)

<p>HDF is a widely-used, free, portable library and file format
for multi-dimensional scientific data, developed in the National
Center for Supercomputing Applications (NCSA) at the University of
Illinois (UIUC, home of the <a
href="http://www.fightingillini.com/">Fighting Illini</a> and <i>alma
mater</i> of many of this author's fine relatives).

<p>There are two incompatible versions of HDF, HDF4 and HDF5 (no, not
HDF1 and HDF2).  We require the newer version, HDF5.  (We use the
newer version because it will be the focus of future development, it
is cleaner, and it supports parallel I/O via MPI.)  Many visualization
and data-analysis tools still use HDF4, but HDF5 includes an
<code>h5toh4</code> conversion program that you can use if you need
HDF4 files.

<p>You can get HDF and learn about it on the <a
href="http://hdf.ncsa.uiuc.edu">HDF Home Page</a>.

<h2>FFTW</h2>

<p>FFTW is a self-optimizing, portable, high-performance FFT
implementation, including both serial and parallel FFTs.  You can
download FFTW and find out more about it from the <a
href="http://www.fftw.org">FFTW Home Page</a>.  If you want to use
Photonic-Bands on a parallel machine with MPI, you will also need to
install the <a href="">MPI FFTW</a> libraries (this just means
including <code>--enable-mpi</code> in the FFTW <code>configure</code>
flags).

<h2>GNU Readline <i>(optional)</i></h2>

<p>GNU Readline is a library to provide command-line history,
tab-completion, emacs keybindings, and other shell-like niceties to
command-line programs.  This is an <em>optional</em> package, but one
that can be used by Guile (see below) if it is installed; we recommend
getting it.  You can <a href="ftp://ftp.gnu.org/gnu/readline">download
Readline from the GNU ftp site</a>.

<h2>GNU Guile</h2>

<p>GNU Guile is an extension/scripting language implementation based on
Scheme, and we use it to provide a rich, fully-programmable
user-interface with minimal effort.  It's free, of course, and you can
download it from the <a
href="http://www.gnu.org/software/guile/">Guile Home
Page</a>.

<h2>libctl</h2>

<p>Instead of using Guile directly, we separated much of the user
interface code into a package called libctl, in the hope that this
might be more generally useful.  libctl automatically handles the
communication between the program and Guile, converting complicated
data structures and so on, to make it even easier to use Guile to
control scientific applications.  Download libctl from the <a
href="http://ab-initio.mit.edu/libctl/">libctl home site</a>, unpack
it, and run the usual <code>configure</code>, <code>make</code>,
<code>make install</code> sequence.  You'll also want to browse its <a
href="http://ab-initio.mit.edu/libctl/doc/">manual</a>, as this will
give you a general overview of what the user interface will be like.

<p>If you are not the system administrator of your machine, and/or
want to install libctl somewhere else (like your home directory), you
can do so with the standard <code>--prefix=<i>dir</i></code> option to
<code>configure</code> (the default prefix is
<code>/usr/local</code>).  In this case, however, you'll need to
specify the location of the libctl shared files for the Photonic-Bands
package, using the <code>--with-libctl=<i>dir</i>/share/libctl</code>
option to the Photonic-Bands <code>configure</code>.

<h2>GNU Autoconf <i>(optional)</i></h2>

<p>If you want to be a developer of the Photonic-Bands package (as
opposed to merely a user), you will also need the GNU Autoconf
program.  Autoconf is a portability tool that generates
<code>configure</code> scripts to automatically detect the
capabilities of a system and configure a package accordingly.  You can
find out more at the <a
href="http://sourceware.cygnus.com/autoconf/">Autoconf Home Page</a>
(autoconf is typically installed by default on Linux systems).  In
order to install Autoconf, you will also need the GNU <code>m4</code>
program if you do not already have it (see the <a
href="http://www.seindal.dk/rene/gnu/">GNU m4 Home Page</a>).

<h2>MIT Photonic-Bands</h2>

<p>Okay, if you've made it all the way here, you're ready to install
the Photonic-Bands package and start cranking out eigenmodes.  (You
can download the latest version and read this manual at the <a
href="http://ab-initio.mit.edu/mpb/">MIT Photonic-Bands Homepage</a>.)
Once you've unpacked it, just run:

<pre>
./configure
make
</pre>

<p>to configure and compile the package.  Hopefully, the
<code>configure</code> script will correctly detect the BLAS, FFTW,
etcetera libraries that you've dutifully installed, as well as the C
compiler and so on, and the <code>make</code> compilation will proceed
without a hitch.  If not, it's a <a
href="http://www.tuxedo.org/~esr/jargon/html/entry/SMOP.html">Simple
Matter of Programming</a> to correct the problem.
<code>configure</code> accepts several flags to help control its
behavior.  Some of these are standard, like
<code>--prefix=<i>dir</i></code> to specify and installation directory
prefix, and some of them are specific to the Photonic-Bands package
(<code>./configure --help</code> for more info).  The
<code>configure</code> flags specific to the Photonic-Bands package
are:

<dl>

<p><dt><code>--enable-single</code>
<dd>Use single precision (C <code>float</code>) instead of the default
double precision (C <code>double</code>) for computations.

<p><dt><code>--disable-complex</code>
<dd>Assume <i>inversion symmetry</i> in the dielectric function,
allowing us to use real fields (in Fourier space) instead of complex
fields.  This gives a factor of 2 benefit in speed and memory.
<i>Not supported yet.</i>

<p><dt><code>--without-fastblas</code>
<dt><code>--with-fastblas=<i>lib</i></code>
<dd>The <code>configure</code> script automatically attempts to detect
accelerated BLAS libraries, like DXML (DEC/Alpha), SCSL and SGIMATH
(SGI/MIPS), ESSL (IBM/PowerPC), ATLAS, and PHiPACK.  You can disable
these by using <code>--without-fastblas</code>, or supply another
library name to try via <code>--with-fastblas=<i>lib</i></code> (it
will attempt to link with <code>-l<i>lib</i></code>).

<p><dt><code>--without-hdf5</code>
<dd>Don't use the HDF5 library for field and dielectric function
output.  (In which case, no field output is possible.)

<p><dt><code>--with-libctl=<i>dir</i></code>
<dd>If libctl was installed in a nonstandard location (i.e. neither
<code>/usr</code> nor <code>/usr/local</code>), you need to specify
the location of the libctl directory, <code><i>dir</i></code>.  This
is either <code><i>prefix</i>/share/libctl</code>, where
<code><i>prefix</i><code> is the installation prefix of libctl, or the
original libctl source code directory.

<p><dt><code>--disable-checks</code>
<dd>Disable runtime checks.  (Not recommended; the disabled checks
shouldn't take up a significant amount of time anyway.)

<p><dt><code>--enable-prof</code>
<dd>Compile for performance profiling.

<p><dt><code>--enable-debug</code>
<dd>Compile for debugging, adding extra runtime checks and so on.

<p><dt><code>--enable-debug-malloc</code>
<dd>Use special memory-allocation routines for extra debugging (to
check for array overwrites, memory leaks, etcetera).

<p><dt><code>--with-efence</code>
<dd>Use the <a href="http://perens.com/FreeSoftware/">Electric
Fence</a> library, if available, for extra runtime array
bounds-checking.

</dl>

<p>You can further control <code>configure</code> by setting various
environment variables, such as:

<ul>

<li><code>CC</code>: the C compiler command

<li><code>CFLAGS</code>: the C compiler flags (defaults to <code>-O3</code>).

<li><code>INCLUDES</code>: <code>-I<i>dir</i></code> flags to tell the
C compiler additional places to look for header files.

<li><code>LDFLAGS</code>: <code>-L<i>dir</i></code> flags to tell the
linker additional places to look for libraries.

<li><code>LIBS</code>: additional libraries to link against.

</ul>

<p>Once compiled, the main program (as opposed to various test
programs) resides in the <code>mpb-ctl/</code> subdirectory, and is
called <code>mpb</code>.  You can install this program under
</code>/usr/local</code> (or elsewhere, if you used the
<code>--prefix</code> flag for <code>configure</code>), by running:

<pre>
make install
</pre>

<hr>
Go to the <a href="user-tutorial.html">next</a>, <a
href="introduction.html">previous</a>, or <a href="index.html">main</a>
section.

</BODY>
</HTML>
