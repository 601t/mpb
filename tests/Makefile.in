# Variables substituted by the autoconf configure script:

SHELL = @SHELL@

CC = @CC@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@ -I../src/util -I../src/matrices -I../src/maxwell
DEFS = @DEFS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
RANLIB = @RANLIB@
@SET_MAKE@

MYLIBS = ../src/maxwell/maxwell.a \
         ../src/matrices/matrices.a \
         ../src/util/util.a 

all: blastest eigs_test maxwell_test malloctest normal_vectors

libs:

check: all
	rm -f blastest.out.test
	./blastest | sed 's/\-0\.000\([ ,)]\)/ 0.000\1/g' | sed 's/\-0\.000$$/ 0.000/g' > blastest.out.test
	diff blastest.@SCALAR_TYPE@.out blastest.out.test
	./maxwell_test -1 -c 1e-9 -x 256 -E 1e-3
	@echo "**********************************************************"
	@echo "                       PASSED tests."
	@echo "**********************************************************"

malloctest: malloctest.o $(MYLIBS)
	$(CC) $(CFLAGS) $(LDFLAGS) malloctest.o $(MYLIBS) $(LIBS) -o $@

blastest: blastest.o $(MYLIBS)
	$(CC) $(CFLAGS) $(LDFLAGS) blastest.o $(MYLIBS) $(LIBS) -o $@

eigs_test: eigs_test.o $(MYLIBS)
	$(CC) $(CFLAGS) $(LDFLAGS) eigs_test.o $(MYLIBS) $(LIBS) -o $@

maxwell_test: maxwell_test.o $(MYLIBS)
	$(CC) $(CFLAGS) $(LDFLAGS) maxwell_test.o $(MYLIBS) $(LIBS) -o $@

normal_vectors: normal_vectors.o $(MYLIBS)
	$(CC) $(CFLAGS) $(LDFLAGS) normal_vectors.o $(MYLIBS) $(LIBS) -o $@

.c.o:
	$(CC) $(DEFS) $(CPPFLAGS) -c $(CFLAGS) $< -o $@

clean: 
	rm -f blastest eigs_test maxwell_test normal_vectors blastest.o \
              eigs_test.o maxwell_test.o normal_vectors.o malloctest.o \
              malloctest core
